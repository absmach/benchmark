# Report from Digitalocean managed [Kubernetes cluster](https://www.digitalocean.com/products/kubernetes/).

Cluster size:  5 Nodes CPU Optimized droplet - 8 vCPU 16 GB RAM

Estimated droplet cost's for cluster: $800/month

Mainflux services scaled to 5 instances

* Mqtt adapter
* Things
* Envoy


## Fan-in Scenario

Publisher pool: 10 000

Subscriber pool: 1

Test durition: 5min

RPS: 1

QoS Level: 2

In this scenario, 10 000 publishers connets and sends 1 one message every second, one subscriber is receiving all those messages.

No message loss was detected.

**NOTE:** Graphs Time unit is microsecond.

![DO fan-in 10k QoS 2 Total messages](assets/DO/DO-fan-in-10k-qos2-totalmsg.png "DO fan-in 10k QoS 2 Total messages")
*We see total number of messages 3M*


![DO fan-in 10k QoS 2 Total messages PRS](assets/DO/DO-fan-in-10k-qos2-totalmsg-rps.png "DO fan-in 10k QoS 2 Total messages")
*We see total number of messages per second (PRS) is 10 000*


![DO fan-in 10k QoS 2 Total messages PRS](assets/DO/DO-fan-in-10k-qos2-totalmsg-rps.png "DO fan-in 10k QoS 2 Total messages RPS")
*We see total number of messages per second (PRS) is 10 000*

![DO fan-in 10k QoS 2 Total messages PRS](assets/DO/DO-fan-in-10k-qos2-connack-latency.png "DO fan-in 10k QoS 2 connection ACK latency")
*We see connection ACK latency*

> Useful facts: 
>* Max latency was up to 20sec
>* 95% Of clients had latency from 5sec up to 15sec under high load
>* Avarge latency was 5sec without pekas

![DO fan-in 10k QoS 2 Publish reveived ACK RPS](assets/DO/DO-fan-in-10k-qos2-pubrec-ack.png "DO fan-in 10k QoS 2  Publish reveived ACK RPS")
*We see Publish received ACK RPS*

![DO fan-in 10k QoS 2 Publish reveived ACK latency](assets/DO/DO-fan-in-10k-qos2-pubrec-latency.png "DO fan-in 10k QoS 2  Publish reveived ACK")
*We see Total Publish received ACK Latency*

> Useful facts: 
>* Max latency was up to 8sec
>* 95% Of clients had latency from 0.5sec up to 6sec under high load
>* Avarge latency was ~2sec without pekas


Results metrics
![DO fan-in 10k QoS 2 Publish reveived ACK latency](assets/DO/DO-fan-in-10k-qos2-results.png "DO fan-in 10k QoS 2  Publish reveived ACK")
*Results metrics are generated by mzbench tool*


### Kubernetes Cluster Node insights
![DO fan-in 10k QoS 2 Cluster node insights](assets/DO/DO-fan-in-10k-qos2-node-insights.png "DO fan-in 10k QoS 2  Cluster node insights")
*Digitalocean Kubernetes cluster node's insights during testing*

## Fan-out Scenario
TBA